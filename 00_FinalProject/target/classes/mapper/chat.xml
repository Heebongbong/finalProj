<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="chatDAO">
	<select id="chat_list" parameterType="chatDTO" resultType="chatDTO">
		select *, (select nickname from user_profile where user_no = #{user_no2}) nickname 
		from chat_room a join chat b on a.chat_room_no = b.chat_room_no 
		where (user_no1 = #{user_no1} or user_no2 = #{user_no1})
		and (user_no1 = #{user_no2} or user_no2 = #{user_no2})
	</select>
	<select id="chat_room_list" parameterType="int" resultType="chatDTO">
		select * from chat_room 
		where (user_no1 = #{user_no} or user_no2 = #{user_no}) 
		and not exit_user = #{user_no}
	</select>
	<insert id="chat_room_insert" parameterType="chatDTO">
		<selectKey keyProperty="chat_room_no" resultType="int" order="BEFORE">
			select max(chat_room_no) from chat_room
		</selectKey>
		insert into chat_room values(#{chat_room_no}+1, #{user_no1}, #{user_no2}, 0, default)
	</insert>
	<insert id="chat_insert" parameterType="chatDTO">
		<selectKey keyProperty="chat_no" resultType="int" order="BEFORE">
			select max(chat_no) from chat
		</selectKey>
		insert into chat values(#{chat_no}+1, #{chat_room_no}, #{send_user}, #{chat_cont}, now())
	</insert>
</mapper>




