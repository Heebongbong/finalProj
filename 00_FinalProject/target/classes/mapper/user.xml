<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<!-- namespace 명은 패키지를 포함한 DAO 인터페이스, mapper를 구분하는 식별자로 사용 -->
<mapper namespace="userDAO">
	<select id="user_list" resultType="userDTO">
		SELECT * FROM user;
	</select>
	<select id="user_cont" resultType="userDTO" parameterType="int">
		select * from user u join user_profile p on u.user_no = p.user_no
			where u.user_no = #{user_no}
	</select>
	<select id="user_cont_id" resultType="userDTO" parameterType="map">
		select * from user u join user_profile p on u.user_no = p.user_no where u.email = #{email} and u.type = #{type}
	</select>
	<insert id="user_insert_session" parameterType="userSessionDTO">
		insert into user_session values(#{user_no}, #{sessionID}, #{refreshToken}, #{expiresTime})
	</insert>
	<insert id="user_insert_sns" parameterType="userDTO">
		<selectKey resultType="int" keyProperty="user_no" order="BEFORE">
			select max(user_no) from user
		</selectKey>
		insert into user values(#{user_no}+1, #{email}, #{type})
	</insert>
	<insert id="user_insert_sns_profile" parameterType="userDTO">
		<selectKey resultType="int" keyProperty="user_no" order="BEFORE">
			select user_no from user where email = #{email} and type = #{type}
		</selectKey>
		insert into user_profile values(#{user_no}, #{pwd}, #{nickname}, default, #{profile}, now(), 0, 0)
	</insert>
	<delete id="user_delete_session" parameterType="int">
		delete from user_session where user_no = #{user_no}
	</delete>
	<select id="user_nick_check" parameterType="String" resultType="String">
		select nickname from user_profile where nickname = #{nickName}
	</select>
	<select id="user_get_session" parameterType="int" resultType="userSessionDTO">
		select * from user_session where user_no = #{user_no}
	</select>
</mapper>