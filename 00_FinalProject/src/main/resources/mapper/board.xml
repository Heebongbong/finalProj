<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<!-- namespace 명은 패키지를 포함한 DAO 인터페이스, mapper를 구분하는 식별자로 사용 -->
<mapper namespace="boardDAO">
	<select id="board_list" resultType="boardDTO">
		select * from community a 
		join (select c.user_no, c.email, c.type, d.nickname, d.profile 
			from user c join user_profile d on c.user_no = d.user_no where type != 'D') b 
		on a.user_no = b.user_no order by cm_no desc Limit 5
	</select>
	<select id="board_list_search" resultType="boardDTO" parameterType="String">
		select * from community a 
		join (select c.user_no, c.email, c.type, d.nickname, d.profile 
			from user c join user_profile d on c.user_no = d.user_no where type != 'D') b 
		on a.user_no = b.user_no where hashtag like concat('%',#{keyword},'%') order by cm_no desc Limit 5
	</select>
	
	<select id="board_list_add" resultType="boardDTO" parameterType="int">
		<![CDATA[
			select * from community a 
			join (select c.user_no, c.email, c.type, d.nickname, d.profile 
				from user c join user_profile d on c.user_no = d.user_no where type != 'D') b 
			on a.user_no = b.user_no  where cm_no < #{cm_no} order by cm_no desc Limit 5
		]]>
	</select>
	
	<select id="board_list_add_search" resultType="boardDTO" parameterType="map">
		<![CDATA[
			select * from community a 
			join (select c.user_no, c.email, c.type, d.nickname, d.profile 
				from user c join user_profile d on c.user_no = d.user_no where type != 'D') b 
			on a.user_no = b.user_no  where cm_no < #{cm_no} and hashtag like concat('%',#{keyword},'%') order by cm_no desc Limit 5
		]]>
	</select>
	
	<insert id="board_insert" parameterType="boardDTO">
	<selectKey keyProperty="cm_no" resultType="int" order="BEFORE">
		select max(cm_no) from community
	</selectKey>
        insert into community (cm_no, user_no, hashtag, content, date, photo_folder)
        values (#{cm_no} +1, #{user_no}, #{hashtag}, #{content}, now(), #{photo_folder})
    </insert>
    
</mapper>